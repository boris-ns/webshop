package webshop.rules;

import rs.ac.uns.ftn.webshopservice.model.Buyer;
import rs.ac.uns.ftn.webshopservice.model.enums.BuyerCategory;
import rs.ac.uns.ftn.webshopservice.model.Product;
import rs.ac.uns.ftn.webshopservice.model.Order;

// global Order order;

rule "GOLD buyers have 5% discount on all articles"
    no-loop true
    when
        $order: Order(product.maxDiscount >= discount + 0.05)
        $buyer: Buyer(category == BuyerCategory.GOLD)
    then
        modify($order) { setDiscount($order.discount + 0.05) }
        System.out.println("[DROOLS] Added discount for GOLD buyer");
end

rule "DIAMOND buyers have 10% discount on all articles"
    no-loop true
    when
        $order: Order(product.maxDiscount >= discount + 0.1)
        $buyer: Buyer(category == BuyerCategory.DIAMOND)
    then
        modify($order) { setDiscount($order.discount + 0.1) }
        System.out.println("[DROOLS] Added discount for DIAMOND buyer");
end

rule "Regular users pay shipment"
    no-loop true
    when
        $buyer: Buyer(category == BuyerCategory.REGULAR)
        $order: Order(product.shippingPrice != 0)
    then
        modify($order) { setPrice(price + $order.product.shippingPrice); }
        System.out.println("[DROOLS] Added shipping price to the order");
end

rule "Add product discount"
    no-loop true
    when
        $order: Order(product.maxDiscount >= discount)
    then
        modify($order) { setDiscount($order.discount + $order.product.discount); }
        System.out.println("[DROOLS] Added product discount to the order");
end
